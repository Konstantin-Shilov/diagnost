import type {
  BurnoutLevel,
  DiagnosticResult,
  GreenbergStage,
  ScoringRules,
  SurveyResponse,
} from "@/core/types";

export class AnalysisService {
  private static calculateScores(responses: SurveyResponse[]): {
    symptomsScore: number;
    stateScore: number;
    causesScore: number;
    totalScore: number;
  } {
    let symptomsScore = 0;
    let stateScore = 0;
    let causesScore = 0;

    for (const response of responses) {
      if (response.blockId === "symptoms") {
        // 1. –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ –ø–æ —Å–∏–º–ø—Ç–æ–º–∞–º (0-3 –∑–∞ –∫–∞–∂–¥—ã–π, 10 –≤–æ–ø—Ä–æ—Å–æ–≤)
        // –ú–∞–∫—Å–∏–º—É–º: 10 √ó 3 = 30
        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            symptomsScore += answer.value;
          }
        }
      } else if (response.blockId === "state") {
        // 2. –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—ç–Ω–µ—Ä–≥–∏—è, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)
        let energyScore = 0;
        let tensionScore = 0;
        let moodScore = 0;

        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            if (answer.questionId === "state_energy") {
              // –≠–Ω–µ—Ä–≥–∏—è: ‚â§3 ‚Üí +3, 4-6 ‚Üí +2, 7-10 ‚Üí +1
              if (answer.value <= 3) energyScore = 3;
              else if (answer.value <= 6) energyScore = 2;
              else energyScore = 1;
            } else if (answer.questionId === "state_tension") {
              // –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: ‚â•8 ‚Üí +3, 6-7 ‚Üí +2, 1-5 ‚Üí +1
              if (answer.value >= 8) tensionScore = 3;
              else if (answer.value >= 6) tensionScore = 2;
              else tensionScore = 1;
            } else if (answer.questionId === "state_mood") {
              // –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: 0-3 ‚Üí +3, 4-6 ‚Üí +2, 7-10 ‚Üí +1
              if (answer.value <= 3) moodScore = 3;
              else if (answer.value <= 6) moodScore = 2;
              else moodScore = 1;
            }
          }
        }

        stateScore = energyScore + tensionScore + moodScore;
        // –ú–∞–∫—Å–∏–º—É–º: 3 + 3 + 3 = 9
      } else if (response.blockId === "internal_causes") {
        // 3. –ü–æ–¥—Å—á—ë—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–∏—á–∏–Ω (0-3 –∑–∞ –∫–∞–∂–¥—É—é, 15 –≤–æ–ø—Ä–æ—Å–æ–≤)
        // –ú–∞–∫—Å–∏–º—É–º: 15 √ó 3 = 45
        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            causesScore += answer.value;
          }
        }
      }
    }

    // 4. –ò—Ç–æ–≥–æ–≤—ã–π –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–ª –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
    // –°–∏–º–ø—Ç–æ–º—ã √ó 0.5 + –ü—Ä–∏—á–∏–Ω—ã √ó 0.3 + –°–æ—Å—Ç–æ—è–Ω–∏–µ √ó 0.2
    const totalScore = Math.round(symptomsScore * 0.5 + causesScore * 0.3 + stateScore * 0.2);

    return {
      symptomsScore,
      stateScore,
      causesScore,
      totalScore,
    };
  }

  private static getBurnoutLevel(score: number, rules: ScoringRules): BurnoutLevel {
    const { burnoutLevels } = rules;

    let level: BurnoutLevel["level"];
    let description: string;

    if (score >= burnoutLevels.critical.min) {
      level = "critical";
      description =
        "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –∏ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–∑–µ –∂–∏–∑–Ω–∏.";
    } else if (score >= burnoutLevels.severe.min) {
      level = "severe";
      description =
        "–°–µ—Ä—å–µ–∑–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.";
    } else if (score >= burnoutLevels.high.min) {
      level = "high";
      description =
        "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ—Ä—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.";
    } else if (score >= burnoutLevels.moderate.min) {
      level = "moderate";
      description =
        "–£–º–µ—Ä–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –°—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã.";
    } else {
      level = "low";
      description =
        "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –í–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º.";
    }

    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
    // –°–∏–º–ø—Ç–æ–º—ã(30) √ó 0.5 + –ü—Ä–∏—á–∏–Ω—ã(45) √ó 0.3 + –°–æ—Å—Ç–æ—è–Ω–∏–µ(9) √ó 0.2
    // = 15 + 13.5 + 1.8 = 30.3 ‚âà 30
    const maxTotalScore = 30;

    return {
      level,
      score,
      maxScore: maxTotalScore,
      percentage: Math.round((score / maxTotalScore) * 100),
      description,
    };
  }

  private static getGreenbergStage(score: number, rules: ScoringRules): GreenbergStage {
    const { greenbergStages } = rules;

    if (score >= greenbergStages[5].min) {
      return {
        stage: 5,
        name: "–£–≥–∞—Å–∞–Ω–∏–µ",
        description:
          "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—É—Å—Ç–æ—Ç–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–º—ã—Å–ª–∞, –ø–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏. –ö–∞–∂–µ—Ç—Å—è, —á—Ç–æ –∂–∏–∑–Ω—å —Å—Ç–∞–ª–∞ —á—ë—Ä–Ω–æ-–±–µ–ª–æ–π.",
        bpsp: {
          body: "—É—Å—Ç–æ–π—á–∏–≤–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ, –ø—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è",
          emotions: '–æ—Ç—Ä–µ—à—ë–Ω–Ω–æ—Å—Ç—å, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è "–∑–∞–º–æ—Ä–æ–∑–∫–∞"',
          thoughts: "¬´–ú–Ω–µ –≤—Å—ë —Ä–∞–≤–Ω–æ¬ª, ¬´–•–æ—á—É –∏—Å—á–µ–∑–Ω—É—Ç—å¬ª",
          behavior: "–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —É—Ç—Ä–∞—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫–æ –≤—Å–µ–º—É",
        },
        whyDangerous:
          "–≠—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∏–æ—Ö–∏–º–∏—é –º–æ–∑–≥–∞, –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã –ø–æ –∑–¥–æ—Ä–æ–≤—å—é. –¢—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏.",
        fact: "–í–û–ó –æ—Ç–Ω–æ—Å–∏—Ç —ç—Ç—É —Å—Ç–∞–¥–∏—é –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º, —Ç—Ä–µ–±—É—é—â–∏–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∏–ª–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.",
      };
    }
    if (score >= greenbergStages[4].min) {
      return {
        stage: 4,
        name: "–ò—Å—Ç–æ—â–µ–Ω–∏–µ",
        description:
          "–≠–Ω–µ—Ä–≥–∏–∏ –ø–æ—á—Ç–∏ –Ω–µ—Ç. –û—Ç–Ω–æ—à–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞ –∏ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–∞–¥–∞—é—Ç. –ü–æ—è–≤–ª—è–µ—Ç—Å—è —á—É–≤—Å—Ç–≤–æ –±–µ–∑–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, —á–∞—Å—Ç—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, —Ç—Ä–µ–≤–æ–≥–∞.",
        bpsp: {
          body: "–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ–∏, –ø—Ä–æ–±–ª–µ–º—ã —Å –ñ–ö–¢",
          emotions: "—Ç—Ä–µ–≤–æ–≥–∞, –≤–∏–Ω–∞, –æ—Ç—á–∞—è–Ω–∏–µ",
          thoughts: "¬´–Ø –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å¬ª",
          behavior: "–∏–∑–±–µ–≥–∞–Ω–∏–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤—Å–ø–ª–µ—Å–∫–∏, —Å—Ä—ã–≤—ã",
        },
        whyDangerous:
          "–ù–∞ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è —Ä–∏—Å–∫ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ —É—Ö—É–¥—à–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–π—Ç–∏ —Å–ª–æ–∂–Ω–æ ‚Äî —á–µ–ª–æ–≤–µ–∫ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∞–∫—Ü–∏—è—Ö.",
        fact: "–ü–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ, –∫–∞–∂–¥—ã–π —Ç—Ä–µ—Ç–∏–π —á–µ–ª–æ–≤–µ–∫ –≤ —Å—Ç–∞–¥–∏–∏ –∏—Å—Ç–æ—â–µ–Ω–∏—è —Ç–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –∏–ª–∏ drastically —Å–Ω–∏–∂–∞–µ—Ç –¥–æ—Ö–æ–¥ –≤ —Ç–µ—á–µ–Ω–∏–µ 1‚Äì2 –ª–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–º–æ—â—å.",
      };
    }
    if (score >= greenbergStages[3].min) {
      return {
        stage: 3,
        name: "–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã",
        description:
          '–°–∏–ª –≤—Å—ë –º–µ–Ω—å—à–µ, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–ø–∞—Ç–∏—è, —á–∞—Å—Ç—ã–µ –±–æ–ª–µ–∑–Ω–∏, –ø–æ—Ç–µ—Ä—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏. –ö–∞–∂–µ—Ç—Å—è, —á—Ç–æ "–∂–∏–∑–Ω—å –≤—ã–∂–∞—Ç–∞".',
        bpsp: {
          body: "–ø—Ä–æ—Å—Ç—É–¥—ã, –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ, —Å–∫–∞—á–∫–∏ –¥–∞–≤–ª–µ–Ω–∏—è –∏ —Ç.–¥.",
          emotions: "–æ–±–∏–¥–∞, –ø—É—Å—Ç–æ—Ç–∞",
          thoughts: "¬´–ù–∏–∫–æ–º—É –¥–æ –º–µ–Ω—è –Ω–µ—Ç –¥–µ–ª–∞¬ª",
          behavior: "–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è, —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        },
        whyDangerous:
          "–ò–¥—ë—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞. –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Å–µ–º—å—é, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –ª–∏—á–Ω–æ—Å—Ç—å.",
        fact: '–í 80% —Å–ª—É—á–∞–µ–≤ –ª—é–¥–∏ –≤ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ "–æ—Ç–ø—É—Å–∫ –≤—Å—ë –∏—Å–ø—Ä–∞–≤–∏—Ç", –Ω–æ —á–µ—Ä–µ–∑ 2‚Äì4 –Ω–µ–¥–µ–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è. –ü—Ä–∏—á–∏–Ω–∞ ‚Äî –Ω–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º—ã.',
      };
    }
    if (score >= greenbergStages[2].min) {
      return {
        stage: 2,
        name: "–£—Å—Ç–∞–ª–æ—Å—Ç—å",
        description:
          "–ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–Ω–æ–º. –ß–µ–ª–æ–≤–µ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ —É—Å–∏–ª–∏–µ.",
        bpsp: {
          body: "–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –≥–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏",
          emotions: "—Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ, –≤–∏–Ω–∞",
          thoughts: "¬´–ù–∞–¥–æ —Å–æ–±—Ä–∞—Ç—å—Å—è¬ª",
          behavior: "–æ—Ç–¥—ã—Ö –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∏–º—É–ª—è—Ü–∏–µ–π (–∫–æ—Ñ–µ, —Ä–∞–±–æ—Ç–∞ –¥–∞–ª—å—à–µ)",
        },
        whyDangerous:
          "–¢–µ–ª–æ —É–∂–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º. –ï—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞—Å—Å—ã–ø–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
        fact: "–ü–æ –¥–∞–Ω–Ω—ã–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –ì–∞—Ä–≤–∞—Ä–¥–∞, 72% —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ —É–∂–µ –∏–º–µ—é—Ç –ø–µ—Ä–≤—ã–µ –ø—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã.",
      };
    }
    return {
      stage: 1,
      name: "–≠–Ω—Ç—É–∑–∏–∞–∑–º",
      description:
        '–í—ã –∑–∞—Ä—è–∂–µ–Ω—ã, —Ö–æ—Ç–∏—Ç–µ –¥–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Ü–µ–Ω–Ω–æ—Å—Ç—å, –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç–µ –æ—Ç–¥—ã—Ö. –ß–∞—Å—Ç–æ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ "–Ø —Å–ø—Ä–∞–≤–ª—é—Å—å! –ù–∞–¥–æ —Ç–æ–ª—å–∫–æ —á—É—Ç—å –±–æ–ª—å—à–µ –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è."',
      bpsp: {
        body: "–≤—ã—Å–æ–∫–∏–π —Ç–æ–Ω—É—Å, —Å–∫—Ä—ã—Ç–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –º—ã—à–µ—á–Ω—ã–µ –∑–∞–∂–∏–º—ã",
        emotions: "–≤–æ–æ–¥—É—à–µ–≤–ª–µ–Ω–∏–µ, –ª–µ–≥–∫–∞—è —Ç—Ä–µ–≤–æ–≥–∞",
        thoughts: "¬´–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª",
        behavior: "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏, –æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–¥—ã—Ö–∞",
      },
      whyDangerous:
        "–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –∑–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º—ã: ¬´–µ—Å–ª–∏ —è —Ä–∞—Å—Å–ª–∞–±–ª—é—Å—å ‚Äî –≤—Å—ë —Ä—É—Ö–Ω–µ—Ç¬ª. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ —Ç–µ–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫–æ 2-–π —Å—Ç–∞–¥–∏–∏.",
      fact: "–î–æ 60% –ª—é–¥–µ–π –≤—Ö–æ–¥—è—Ç –≤ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –∏–∑ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ ‚Äî –Ω–µ–∑–∞–º–µ—Ç–Ω–æ.",
    };
  }

  private static getRecommendations(burnoutLevel: BurnoutLevel, stage: GreenbergStage): string[] {
    const recommendations: string[] = [];

    // Base recommendations based on burnout level
    switch (burnoutLevel.level) {
      case "critical":
        recommendations.push(
          "üö® –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é",
          "üè• –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ—Ç–ø—É—Å–∫–∞",
          "üîÑ –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",
          "üë• –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫ –±–ª–∏–∑–∫–∏–º",
        );
        break;
      case "severe":
        recommendations.push(
          "üë®‚Äç‚öïÔ∏è –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é",
          "‚è∞ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ä–∞–±–æ—á—É—é –Ω–∞–≥—Ä—É–∑–∫—É",
          "üßò –í–Ω–µ–¥—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Å—Ç—Ä–µ—Å—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞",
          "üí§ –û–±–µ—Å–ø–µ—á—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω –∏ –æ—Ç–¥—ã—Ö",
        );
        break;
      case "high":
        recommendations.push(
          "üìã –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –∑–∞–¥–∞—á–∏",
          'üö´ –ù–∞—É—á–∏—Ç–µ—Å—å –≥–æ–≤–æ—Ä–∏—Ç—å "–Ω–µ—Ç" –ª–∏—à–Ω–∏–º –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º',
          "üèÉ‚Äç‚ôÇÔ∏è –£–≤–µ–ª–∏—á—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
          "üéØ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–æ–π –∏ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω—å—é",
        );
        break;
      case "moderate":
        recommendations.push(
          "‚öñÔ∏è –°–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º —Ä–∞–±–æ—Ç—ã –∏ –æ—Ç–¥—ã—Ö–∞",
          "üßò‚Äç‚ôÄÔ∏è –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏",
          "üìÖ –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã",
          "üí™ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–º",
        );
        break;
      case "low":
        recommendations.push(
          "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º",
          "üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å",
          "üìà –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ —Å—Ç—Ä–µ—Å—Å–∞",
          "ü§ù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏",
        );
        break;
    }

    // Additional recommendations based on Greenberg stage
    if (stage.stage >= 3) {
      recommendations.push(
        "üó£Ô∏è –û—Ç–∫—Ä—ã—Ç–æ –æ–±—Å—É–¥–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º",
        "üîÑ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ä–æ–ª–∏",
      );
    }

    if (stage.stage >= 4) {
      recommendations.push(
        "üåø –í–æ–∑—å–º–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–ø—É—Å–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è",
        "üß† –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—é –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
      );
    }

    return recommendations;
  }

  public static analyzeResults(
    responses: SurveyResponse[],
    scoringRules: ScoringRules,
  ): DiagnosticResult {
    const scores = this.calculateScores(responses);
    const burnoutLevel = this.getBurnoutLevel(scores.totalScore, scoringRules);
    const greenbergStage = this.getGreenbergStage(scores.totalScore, scoringRules);
    const recommendations = this.getRecommendations(burnoutLevel, greenbergStage);

    return {
      id: `result_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      timestamp: new Date(),
      responses,
      burnoutLevel,
      greenbergStage,
      totalScore: scores.totalScore,
      maxTotalScore: burnoutLevel.maxScore,
      recommendations,
    };
  }
}
