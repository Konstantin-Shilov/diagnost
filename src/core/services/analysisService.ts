import type {
  BurnoutLevel,
  DiagnosticResult,
  GreenbergStage,
  ScoringRules,
  SurveyResponse,
} from "@/core/types";

export class AnalysisService {
  private static calculateScores(responses: SurveyResponse[]): {
    symptomsScore: number;
    stateScore: number;
    causesScore: number;
    totalScore: number;
  } {
    let symptomsScore = 0;
    let stateScore = 0;
    let causesScore = 0;

    for (const response of responses) {
      if (response.blockId === "symptoms") {
        // 1. –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ –ø–æ —Å–∏–º–ø—Ç–æ–º–∞–º (0-3 –∑–∞ –∫–∞–∂–¥—ã–π, 10 –≤–æ–ø—Ä–æ—Å–æ–≤)
        // –ú–∞–∫—Å–∏–º—É–º: 10 √ó 3 = 30
        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            symptomsScore += answer.value;
          }
        }
      } else if (response.blockId === "state") {
        // 2. –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—ç–Ω–µ—Ä–≥–∏—è, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)
        let energyScore = 0;
        let tensionScore = 0;
        let moodScore = 0;

        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            if (answer.questionId === "state_energy") {
              // –≠–Ω–µ—Ä–≥–∏—è: ‚â§3 ‚Üí +3, 4-6 ‚Üí +2, 7-10 ‚Üí +1
              if (answer.value <= 3) energyScore = 3;
              else if (answer.value <= 6) energyScore = 2;
              else energyScore = 1;
            } else if (answer.questionId === "state_tension") {
              // –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: ‚â•8 ‚Üí +3, 6-7 ‚Üí +2, 1-5 ‚Üí +1
              if (answer.value >= 8) tensionScore = 3;
              else if (answer.value >= 6) tensionScore = 2;
              else tensionScore = 1;
            } else if (answer.questionId === "state_mood") {
              // –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: 0-3 ‚Üí +3, 4-6 ‚Üí +2, 7-10 ‚Üí +1
              if (answer.value <= 3) moodScore = 3;
              else if (answer.value <= 6) moodScore = 2;
              else moodScore = 1;
            }
          }
        }

        stateScore = energyScore + tensionScore + moodScore;
        // –ú–∞–∫—Å–∏–º—É–º: 3 + 3 + 3 = 9
      } else if (response.blockId === "internal_causes") {
        // 3. –ü–æ–¥—Å—á—ë—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–∏—á–∏–Ω (0-3 –∑–∞ –∫–∞–∂–¥—É—é, 15 –≤–æ–ø—Ä–æ—Å–æ–≤)
        // –ú–∞–∫—Å–∏–º—É–º: 15 √ó 3 = 45
        for (const answer of response.answers) {
          if (typeof answer.value === "number") {
            causesScore += answer.value;
          }
        }
      }
    }

    // 4. –ò—Ç–æ–≥–æ–≤—ã–π –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–ª –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
    // –°–∏–º–ø—Ç–æ–º—ã √ó 0.5 + –ü—Ä–∏—á–∏–Ω—ã √ó 0.3 + –°–æ—Å—Ç–æ—è–Ω–∏–µ √ó 0.2
    const totalScore = Math.round(symptomsScore * 0.5 + causesScore * 0.3 + stateScore * 0.2);

    return {
      symptomsScore,
      stateScore,
      causesScore,
      totalScore,
    };
  }

  private static getBurnoutLevel(score: number, rules: ScoringRules): BurnoutLevel {
    const { burnoutLevels } = rules;

    let level: BurnoutLevel["level"];
    let description: string;

    if (score >= burnoutLevels.critical.min) {
      level = "critical";
      description =
        "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –∏ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–∑–µ –∂–∏–∑–Ω–∏.";
    } else if (score >= burnoutLevels.severe.min) {
      level = "severe";
      description =
        "–°–µ—Ä—å–µ–∑–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.";
    } else if (score >= burnoutLevels.high.min) {
      level = "high";
      description =
        "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ—Ä—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.";
    } else if (score >= burnoutLevels.moderate.min) {
      level = "moderate";
      description =
        "–£–º–µ—Ä–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –°—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã.";
    } else {
      level = "low";
      description =
        "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –í–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º.";
    }

    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
    // –°–∏–º–ø—Ç–æ–º—ã(30) √ó 0.5 + –ü—Ä–∏—á–∏–Ω—ã(45) √ó 0.3 + –°–æ—Å—Ç–æ—è–Ω–∏–µ(9) √ó 0.2
    // = 15 + 13.5 + 1.8 = 30.3 ‚âà 30
    const maxTotalScore = 30;

    return {
      level,
      score,
      maxScore: maxTotalScore,
      percentage: Math.round((score / maxTotalScore) * 100),
      description,
    };
  }

  private static getGreenbergStage(score: number, rules: ScoringRules): GreenbergStage {
    const { greenbergStages } = rules;

    if (score >= greenbergStages[5].min) {
      return {
        stage: 5,
        name: "–£–≥–∞—Å–∞–Ω–∏–µ",
        description: "–ü–æ–ª–Ω–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ, –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç –∂–∏–∑–Ω–∏",
        characteristics: [
          "–¢–µ–ª–æ: –•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è, –ø—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏–∫–∞, —É–ø–∞–¥–æ–∫ —Å–∏–ª",
          "–≠–º–æ—Ü–∏–∏: –ü—É—Å—Ç–æ—Ç–∞, –∞–ø–∞—Ç–∏—è, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á—É–≤—Å—Ç–≤",
          "–ú—ã—Å–ª–∏: –ë–µ–∑–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö",
          "–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –ò–∑–æ–ª—è—Ü–∏—è, –∏–∑–±–µ–≥–∞–Ω–∏–µ –ª—é–¥–µ–π –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π",
          "–†–∏—Å–∫: –î–µ–ø—Ä–µ—Å—Å–∏—è, —Å–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ –∑–¥–æ—Ä–æ–≤—å–µ–º, –ø–æ—Ç–µ—Ä—è —Ç—Ä—É–¥–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
        ],
      };
    }
    if (score >= greenbergStages[4].min) {
      return {
        stage: 4,
        name: "–ò—Å—Ç–æ—â–µ–Ω–∏–µ",
        description: "–ì–ª—É–±–æ–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞, –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü–∏–µ–π",
        characteristics: [
          "–¢–µ–ª–æ: –ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –≥–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏, –º—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
          "–≠–º–æ—Ü–∏–∏: –¢—Ä–µ–≤–æ–≥–∞, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ä—ã–≤—ã",
          "–ú—ã—Å–ª–∏: –ù–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∞, —á—É–≤—Å—Ç–≤–æ –±–µ–∑–≤—ã—Ö–æ–¥–Ω–æ—Å—Ç–∏",
          "–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã, —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∏–∑–±–µ–≥–∞–Ω–∏–µ –∑–∞–¥–∞—á",
          "–†–∏—Å–∫: –¢—Ä–µ–≤–æ–∂–Ω—ã–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –ø—Ä–æ–±–ª–µ–º—ã –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å",
        ],
      };
    }
    if (score >= greenbergStages[3].min) {
      return {
        stage: 3,
        name: "–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã",
        description: "–°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏, —á–∞—Å—Ç—ã–µ –Ω–µ–¥–æ–º–æ–≥–∞–Ω–∏—è, –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å",
        characteristics: [
          "–¢–µ–ª–æ: –ß–∞—Å—Ç—ã–µ –ø—Ä–æ—Å—Ç—É–¥—ã, —Å–Ω–∏–∂–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞, —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Å–ª–∞–±–æ—Å—Ç—å",
          "–≠–º–æ—Ü–∏–∏: –ê–ø–∞—Ç–∏—è, –ø–æ—Ç–µ—Ä—è –∏–Ω—Ç–µ—Ä–µ—Å–∞, —Ü–∏–Ω–∏–∑–º",
          "–ú—ã—Å–ª–∏: –°–æ–º–Ω–µ–Ω–∏—è –≤ —Å–≤–æ–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö, –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π",
          "–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –§–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π, –∏–∑–±–µ–≥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã",
          "–†–∏—Å–∫: –£—Ö—É–¥—à–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è, —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã, –æ—Ç—á—É–∂–¥–µ–Ω–∏–µ",
        ],
      };
    }
    if (score >= greenbergStages[2].min) {
      return {
        stage: 2,
        name: "–£—Å—Ç–∞–ª–æ—Å—Ç—å",
        description: "–ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –ø–µ—Ä–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏—Å—Ç–æ—â–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤",
        characteristics: [
          "–¢–µ–ª–æ: –£—Å—Ç–∞–ª–æ—Å—Ç—å –ø–æ —É—Ç—Ä–∞–º, –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–Ω–∞, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ",
          "–≠–º–æ—Ü–∏–∏: –†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, —Å–Ω–∏–∂–µ–Ω–∏–µ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞",
          "–ú—ã—Å–ª–∏: –ù–∞—á–∞–ª–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è, —Å–æ–º–Ω–µ–Ω–∏—è, –ø–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞",
          "–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∫–æ—Ñ–µ/—Å–ª–∞–¥–∫–∏–º, –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–¥—ã—Ö",
          "–†–∏—Å–∫: –†–∞–∑–≤–∏—Ç–∏–µ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–ª–æ—Å—Ç–∏, —É—Ö—É–¥—à–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Å–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        ],
      };
    }
    return {
      stage: 1,
      name: "–≠–Ω—Ç—É–∑–∏–∞–∑–º",
      description:
        '–í—ã –∑–∞—Ä—è–∂–µ–Ω—ã, —Ö–æ—Ç–∏—Ç–µ –¥–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Ü–µ–Ω–Ω–æ—Å—Ç—å, –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç–µ –æ—Ç–¥—ã—Ö. –ß–∞—Å—Ç–æ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ "–Ø —Å–ø—Ä–∞–≤–ª—é—Å—å! –ù–∞–¥–æ —Ç–æ–ª—å–∫–æ —á—É—Ç—å –±–æ–ª—å—à–µ –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è."',
      characteristics: [
        "–¢–µ–ª–æ: –≤—ã—Å–æ–∫–∏–π —Ç–æ–Ω—É—Å, —Å–∫—Ä—ã—Ç–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –º—ã—à–µ—á–Ω—ã–µ –∑–∞–∂–∏–º—ã",
        "–≠–º–æ—Ü–∏–∏: –≤–æ–æ–¥—É—à–µ–≤–ª–µ–Ω–∏–µ, –ª–µ–≥–∫–∞—è —Ç—Ä–µ–≤–æ–≥–∞",
        "–ú—ã—Å–ª–∏: ¬´–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª",
        "–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏, –æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–¥—ã—Ö–∞",
        "–†–∏—Å–∫: –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –∑–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º—ã: ¬´–µ—Å–ª–∏ —è —Ä–∞—Å—Å–ª–∞–±–ª—é—Å—å ‚Äî –≤—Å—ë —Ä—É—Ö–Ω–µ—Ç¬ª. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ —Ç–µ–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫–æ 2-–π —Å—Ç–∞–¥–∏–∏. –î–æ 60% –ª—é–¥–µ–π –≤—Ö–æ–¥—è—Ç –≤ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –∏–∑ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ ‚Äî –Ω–µ–∑–∞–º–µ—Ç–Ω–æ",
      ],
    };
  }

  private static getRecommendations(burnoutLevel: BurnoutLevel, stage: GreenbergStage): string[] {
    const recommendations: string[] = [];

    // Base recommendations based on burnout level
    switch (burnoutLevel.level) {
      case "critical":
        recommendations.push(
          "üö® –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é",
          "üè• –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ—Ç–ø—É—Å–∫–∞",
          "üîÑ –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",
          "üë• –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫ –±–ª–∏–∑–∫–∏–º",
        );
        break;
      case "severe":
        recommendations.push(
          "üë®‚Äç‚öïÔ∏è –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é",
          "‚è∞ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ä–∞–±–æ—á—É—é –Ω–∞–≥—Ä—É–∑–∫—É",
          "üßò –í–Ω–µ–¥—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Å—Ç—Ä–µ—Å—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞",
          "üí§ –û–±–µ—Å–ø–µ—á—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω –∏ –æ—Ç–¥—ã—Ö",
        );
        break;
      case "high":
        recommendations.push(
          "üìã –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –∑–∞–¥–∞—á–∏",
          'üö´ –ù–∞—É—á–∏—Ç–µ—Å—å –≥–æ–≤–æ—Ä–∏—Ç—å "–Ω–µ—Ç" –ª–∏—à–Ω–∏–º –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º',
          "üèÉ‚Äç‚ôÇÔ∏è –£–≤–µ–ª–∏—á—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
          "üéØ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–æ–π –∏ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω—å—é",
        );
        break;
      case "moderate":
        recommendations.push(
          "‚öñÔ∏è –°–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º —Ä–∞–±–æ—Ç—ã –∏ –æ—Ç–¥—ã—Ö–∞",
          "üßò‚Äç‚ôÄÔ∏è –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏",
          "üìÖ –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã",
          "üí™ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–º",
        );
        break;
      case "low":
        recommendations.push(
          "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º",
          "üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å",
          "üìà –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ —Å—Ç—Ä–µ—Å—Å–∞",
          "ü§ù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏",
        );
        break;
    }

    // Additional recommendations based on Greenberg stage
    if (stage.stage >= 3) {
      recommendations.push(
        "üó£Ô∏è –û—Ç–∫—Ä—ã—Ç–æ –æ–±—Å—É–¥–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º",
        "üîÑ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ä–æ–ª–∏",
      );
    }

    if (stage.stage >= 4) {
      recommendations.push(
        "üåø –í–æ–∑—å–º–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–ø—É—Å–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è",
        "üß† –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—é –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
      );
    }

    return recommendations;
  }

  public static analyzeResults(
    responses: SurveyResponse[],
    scoringRules: ScoringRules,
  ): DiagnosticResult {
    const scores = this.calculateScores(responses);
    const burnoutLevel = this.getBurnoutLevel(scores.totalScore, scoringRules);
    const greenbergStage = this.getGreenbergStage(scores.totalScore, scoringRules);
    const recommendations = this.getRecommendations(burnoutLevel, greenbergStage);

    return {
      id: `result_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      timestamp: new Date(),
      responses,
      burnoutLevel,
      greenbergStage,
      totalScore: scores.totalScore,
      maxTotalScore: burnoutLevel.maxScore,
      recommendations,
    };
  }
}
